<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - LogiTrace</title>
    <div th:replace="~{layout/common-layout :: head-content}"></div>

    <link rel="stylesheet" th:href="@{/css/custom.css}">
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<script>
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark');
    } else {
        document.body.classList.remove('dark');
    }
</script>

<div th:replace="~{layout/common-layout :: navigation}"></div>

<div class="content-wrapper" style="flex: 1;">

    <div class="hero-section">
        <h1 class="hero-title" style="font-size: 2.5rem; margin-bottom: 0.5rem;">
            Welcome back, <span th:text="${user.firstName}">Client</span>!
        </h1>
        <p class="hero-subtitle" style="font-size: 1.1rem; opacity: 0.9;">
            Track your shipments or check your history from the menu above.
        </p>
    </div>

    <div class="tracking-box" style="max-width: 550px; margin: -5rem auto 3rem;">
        <h2 class="tracking-title">Quick Track</h2>
        <form action="/client/dashboard" method="get" class="tracking-form">
            <input type="text" name="trackingNumber" class="tracking-input"
                   placeholder="Enter Tracking Number (e.g. TRACK123)"
                   th:value="${trackingNumber}" required>
            <button type="submit" class="search-btn">
                <i class="fa-solid fa-magnifying-glass"></i> Track
            </button>
        </form>

        <div th:if="${error}" class="error-message">
            <i class="fa-solid fa-circle-exclamation"></i> <span th:text="${error}"></span>
        </div>
    </div>

    <div th:if="${searchedPackage}" class="result-card" style="max-width: 550px; margin: 0 auto 3rem;">
        <div class="result-header">
            <div>
                <span class="result-label">Tracking Number:</span>
                <div class="result-tracking-number" th:text="${searchedPackage.trackingNumber}">TRACK123</div>
            </div>
            <div class="text-right">
                <span class="result-label">Current Status:</span>
                <div class="result-status" th:text="${searchedPackage.status}">IN TRANSIT</div>
            </div>
        </div>

        <div class="result-details-grid">
            <div>
                <strong>From:</strong>
                <span th:if="${searchedPackage.sender != null && searchedPackage.sender.user != null}"
                      th:text="${searchedPackage.sender.user.firstName} + ' ' + ${searchedPackage.sender.user.lastName}">Sender</span>
                <span th:if="${searchedPackage.sender == null}" style="color: #9ca3af;">Unknown</span>
                <br>

                <strong>To:</strong>
                <span th:if="${searchedPackage.receiver != null && searchedPackage.receiver.user != null}"
                      th:text="${searchedPackage.receiver.user.firstName} + ' ' + ${searchedPackage.receiver.user.lastName}">Receiver</span>
                <span th:if="${searchedPackage.receiver == null}" style="color: #9ca3af;">Unknown</span>
            </div>
            <div class="text-right">
                <strong>Destination:</strong><br>
                <span th:if="${searchedPackage.destinationOffice != null}">
                    <i class="fa-solid fa-building" style="color: #6b7280; margin-right: 4px;"></i>
                    <span th:text="${searchedPackage.destinationOffice.name} + ' (Office)'"></span>
                </span>
                <span th:if="${searchedPackage.destinationOffice == null}">
                    <i class="fa-solid fa-location-dot" style="color: #6b7280; margin-right: 4px;"></i>
                    <span th:text="${searchedPackage.deliveryAddress}"></span>
                </span>
            </div>
        </div>

        <div class="status-timeline">
            <div class="timeline-step" th:classappend="${searchedPackage.status.name() == 'REGISTERED' or searchedPackage.status.name() == 'IN_TRANSIT' or searchedPackage.status.name() == 'DELIVERED' or searchedPackage.status.name() == 'RECEIVED'} ? 'active'">
                <div class="step-circle"><i class="fa-solid fa-file-pen"></i></div>
                <div class="step-label">Registered</div>
            </div>

            <div class="timeline-step" th:classappend="${searchedPackage.status.name() == 'IN_TRANSIT' or searchedPackage.status.name() == 'DELIVERED' or searchedPackage.status.name() == 'RECEIVED'} ? 'active'">
                <div class="step-circle"><i class="fa-solid fa-truck-fast"></i></div>
                <div class="step-label">In Transit</div>
            </div>

            <div class="timeline-step" th:classappend="${searchedPackage.status.name() == 'DELIVERED' or searchedPackage.status.name() == 'RECEIVED'} ? 'active'">
                <div class="step-circle"><i class="fa-solid fa-box-open"></i></div>
                <div class="step-label">Delivered</div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{layout/common-layout :: footer}"></div>

<script th:src="@{/js/theme.js}"></script>
<script th:src="@{/js/menu.js}"></script>

</body>
</html>